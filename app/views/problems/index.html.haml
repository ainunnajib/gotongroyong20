-content_for :header do
  %script{src: 'https://maps.googleapis.com/maps/api/js?v=3.exp'}
  :coffee
    initialize = ->
      mapOptions =
        zoom: 4
        center: indonesia

      map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions)

      for point in points
        marker = new google.maps.Marker(
          map: map
          draggable: true
          animation: google.maps.Animation.DROP
          position: new google.maps.LatLng(point[0], point[1])
        )
        google.maps.event.addListener marker, "click", toggleBounce

      return

    toggleBounce = ->
      if marker.getAnimation()?
        marker.setAnimation null
      else
        marker.setAnimation google.maps.Animation.BOUNCE
      return

    indonesia = new google.maps.LatLng(0,  120.644)
    points = #{long_lat_points(@problems)}
    marker = undefined
    map = undefined
    google.maps.event.addDomListener window, "load", initialize

.row
  .col-md-12
    #map-canvas

.row
  .col-md-12
    %h2 List of problems

  .col-md-12
    .pull-right
      = link_to new_problem_path, class: 'btn btn-primary' do
        %span.glyphicon.glyphicon-plus
        New Problem

  .col-md-12
    %table.table.table-striped
      %thead
        %tr
          %th Title
          %th Category
          %th Summary
          %th Cause
          %th Symptom
          %th Effect
          %th Urgency
          %th Province
          %th Kabupaten
          %th Kecamatan
          %th Reported by
          %th
          %th

      %tbody
        - @problems.each do |problem|
          %tr
            %td=link_to problem.title, problem
            %td= problem.category_name
            %td= problem.summary
            %td= problem.cause
            %td= problem.symptom
            %td= problem.effect
            %td= problem.urgency_name
            %td= problem.province.name
            %td= problem.kabupaten.name
            %td= problem.kecamatan.name
            %td= problem.reported_by.name
